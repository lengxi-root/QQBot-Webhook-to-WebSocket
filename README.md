# Webhook to WebSocket Bridge Service

为提供QQBot的Webhook到WebSocket的实时消息转发能力，以ws将消息推送到客户端，支持消息缓存断线重传、高稳定并发等特性。

### 功能特性

- 📦 **智能缓存**：自动缓存离线消息（5分钟）
- 🔁 **断线重传**：重连后自动补发断线期间的消息
- ⚖️ **负载均衡**：支持多个客户端同时接收相同消息
- ❤️ **心跳机制**：30秒心跳保活设计
- 🚀 **高性能**：基于UVloop和Httptools优化

# 🚀快速开始
**开发提供可直接使用提供的公共服务（无偿群号：1033218561）**

## 🛠️准备工作
- 一个拥有公网IP的服务器
- 一个QQ机器人(用于测试)
- 一个域名(用于接收 Webhook 推送)
- 宝塔面板，宝塔面板拥有 Python 的最新环境(项目本身不依赖宝塔面板,可自行使用命令安装依赖)

### 📁创建python站点

宝塔面板中：网站管理 -> Python项目 -> 添加 Python 项目，指定python文件目录

环境变量选择目录下的requirements.txt，创建环境

### 🔗绑定域名、SSL
点击创建的项目设置 -> 域名管理 -> 绑定域名

再点击外网访问 -> 开启外网映射 -> 端口8000放行，已开启，代理路由：/

重启python项目，验证域名是否可以访问（能打开就行）。

再点击 SSL 证书，申请免费的 Let's Encrypt 证书即可。尝试是否可以 HTTPS 访问。如果正常访问，那么恭喜你，你已经成功部署成功了。

###  🌐开放平台订阅推送
打开QQ开放平台，找到事件通知地址配置区域，输入你的地址：https://{域名}/webhook?secret={机器人密钥}

其中，请将 {域名} 替换为你的域名，{机器人密钥} 替换为你的机器人Secret。

你应该看到开放平台推送了回调验证，不提示任何信息、可以保存配置即代表部署成功！可以保存了。

(进行配置前，需要将客户端连接 WebSocket 至对应 Secret，否则无法完成签名计算、消息推送)

保存后，请配置【事件接收】。

###  🚀客户端连接Websocket
WebSocket统一连接地址格式：`ws://{域名}:8000/ws/{机器人密钥}/{TOKEN}`

注意:推荐开启wss连接，具体开启方法网上寻找

其中，请将 {域名} 替换为你的域名，{机器人密钥} 替换为你的机器人Secret。

## 📝关于 Issues
若在使用中遇到问题，请提交 Issues 进行反馈。

提交的 Issues 请遵照以下规范：
- 标题：简明扼要地描述问题
- 内容：详细描述问题，包括复现步骤、期望结果、实际结果、截图、日志等。
- 标签：请选择合适的标签，如 bug、enhancement、question 等。

错误的提交 Issues 可能会被关闭，请谨慎提交。

## ✨关于 Pull Requests
若有意向参与本项目的开发，请提交 Pull Requests。

提交的 Pull Requests 请遵照以下规范：
- 对源码进行的修改，所有有意义的代码行必须有详细的注释。
- 遵循本项目的编码规范，包括变量命名、函数命名、注释规范等。
- 请确保提交的代码没有任何语法错误或逻辑错误。
- 请确保提交的代码通过了测试。

提交的 Pull Requests 可能会被合并或修改，请耐心等待。